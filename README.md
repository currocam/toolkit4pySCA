
<!-- README.md is generated from README.Rmd. Please edit that file -->

# toolkit4pySCA

<!-- badges: start -->

[![R-CMD-check](https://github.com/currocam/toolkit4pySCA/workflows/R-CMD-check/badge.svg)](https://github.com/currocam/toolkit4pySCA/actions)
<!-- badges: end -->

The goal of toolkit4pySCA is to provide a bunch of useful functions in
order to obtain a sequence alignment using HMMER and associated
taxonomic information.Then, it allows to read the file generated by
pySCA and to analyze the results easily with R and tidyverse.

## Installation

You can install the development version of toolkit4pySCA from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("currocam/toolkit4pySCA")
```

## Example

This is a basic example showing how to carry out a typical workflow.

### phmmer

First, we performed a search for sequences homologous to the sequence of
interest using phmmer, indicating the sequence of interest and the
database. This can be done using `quick_AA_search_using_phmmer`,
`download_xml_from_phmer()` or downloading the xml file from the web
server. Actually, programmatic access to the HMMER only seems to make
sense if you need to perform a lot of queries and want to automate the
process.

``` r
library(toolkit4pySCA)
library(Biostrings)

# >2abl_A mol:protein length:163  ABL TYROSINE KINASE
example.seq <- AAString(
  paste0("MGPSENDPNLFVALYDFVASGDNTLSITKGEKLRVLGYNHNGEWCEAQTKNGQGWVPSNYITPVNSLE",
  "KHSWYHGPVSRNAAEYLLSSGINGSFLVRESESSPGQRSISLRYEGRVYHYRINTASDGKLYVSSESRFNTLAELV",
  "HHHSTVADGLITTLHYPAP")
  )
db <- "pdb"
raw.xml <- quick_AA_search_using_phmmer(example.seq, db)
raw.xml %>%
  read_xml() %>%
  write_xml(xml.document,file = "2abl_A_pdb.xml")
xml.document <- read_xml("2abl_A_pdb.xml")
```

``` r
library(dplyr)
hits <- extract_tidy_hits_from_xml(xml.document)
stats <- extract_tidy_stats_from_xml(xml.document)
hits%>%
  select(pvalue, evalue, score) %>%
  summary()
```

<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
pvalue
</th>
<th style="text-align:left;">
evalue
</th>
<th style="text-align:left;">
score
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Min. :-265.00
</td>
<td style="text-align:left;">
Min. :0.0000000
</td>
<td style="text-align:left;">
Min. : 14.20
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
1st Qu.: -39.72
</td>
<td style="text-align:left;">
1st Qu.:0.0000000
</td>
<td style="text-align:left;">
1st Qu.: 22.80
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Median : -27.96
</td>
<td style="text-align:left;">
Median :0.0000004
</td>
<td style="text-align:left;">
Median : 35.00
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Mean : -35.80
</td>
<td style="text-align:left;">
Mean :0.0341706
</td>
<td style="text-align:left;">
Mean : 46.09
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
3rd Qu.: -19.29
</td>
<td style="text-align:left;">
3rd Qu.:0.0023000
</td>
<td style="text-align:left;">
3rd Qu.: 51.62
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Max. : -13.21
</td>
<td style="text-align:left;">
Max. :1.0000000
</td>
<td style="text-align:left;">
Max. :369.80
</td>
</tr>
</tbody>
</table>

``` r
library(forcats)
hits%>%
  mutate(
    ph = fct_lump(ph, 2),
  ) %>%
  pull(ph)%>%
  fct_count(prop = TRUE, sort = TRUE) %>%
  kbl() %>%
  kable_styling()
```

<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
f
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Chordata
</td>
<td style="text-align:right;">
504
</td>
<td style="text-align:right;">
0.9130435
</td>
</tr>
<tr>
<td style="text-align:left;">
Other
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
0.0380435
</td>
</tr>
<tr>
<td style="text-align:left;">
Ascomycota
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
0.0344203
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0144928
</td>
</tr>
</tbody>
</table>

``` r
library(ggplot2)
hits%>%
  filter(evalue < 0.001) %>%
  mutate(
    ph = fct_lump(ph, 2),
    desc = fct_lump(desc, 4)
  )%>%
  ggplot(aes(y=desc, fill = ph)) + 
    geom_histogram(stat = "count")
```

<img src="man/figures/README-hist_ph_desc_hmmer-1.png" width="100%" />

You’ll still need to render `README.Rmd` regularly, to keep `README.md`
up-to-date. `devtools::build_readme()` is handy for this. You could also
use GitHub Actions to re-render `README.Rmd` every time you push. An
example workflow can be found here:
<https://github.com/r-lib/actions/tree/v1/examples>.

You can also embed plots, for example:

In that case, don’t forget to commit and push the resulting figure
files, so they display on GitHub and CRAN.
